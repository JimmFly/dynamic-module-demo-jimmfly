# Dynamic Module Demo Jimmfly

ä¸€ä¸ªé«˜æ€§èƒ½çš„åŠ¨æ€æ¨¡å—æ‰§è¡Œå™¨ï¼Œæ”¯æŒçƒ­é‡è½½åŠŸèƒ½çš„ TypeScript HTTP æœåŠ¡å™¨é¡¹ç›®ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ðŸš€ **é«˜æ€§èƒ½HTTPæœåŠ¡å™¨**ï¼šè‡ªåŠ¨ç«¯å£æ£€æµ‹ï¼Œæ”¯æŒ 8080/8081 ç«¯å£
- ðŸ”„ **åŠ¨æ€æ¨¡å—åŠ è½½**ï¼šæ— éœ€é‡å¯æœåŠ¡å™¨å³å¯åŠ è½½æ–°æ¨¡å—
- ðŸ”¥ **çƒ­é‡è½½åŠŸèƒ½**ï¼šä¿®æ”¹çŽ°æœ‰æ¨¡å—å‡½æ•°åŽè‡ªåŠ¨ç”Ÿæ•ˆ
- ðŸŒ **çŽ°ä»£åŒ–Webç•Œé¢**ï¼šå“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå®žæ—¶æ¨¡å—åˆ·æ–°
- ðŸ’¾ **SQLiteæ•°æ®åº“**ï¼šå®Œæ•´è®°å½•æ‰€æœ‰å‡½æ•°æ‰§è¡ŒåŽ†å²å’Œæ—¥å¿—
- ðŸ”’ **å®‰å…¨æ‰§è¡ŒçŽ¯å¢ƒ**ï¼šæ™ºèƒ½å‚æ•°è§£æžå’ŒéªŒè¯ï¼Œé¿å…ä»£ç æ³¨å…¥
- ðŸ“ **è¯¦ç»†é”™è¯¯æç¤º**ï¼šè¯­ä¹‰åŒ–é”™è¯¯ä¿¡æ¯ï¼Œæ”¯æŒä¸­æ–‡é€—å·æ£€æµ‹
- âš¡ **TypeScriptæ”¯æŒ**ï¼šå®Œæ•´çš„ç±»åž‹æ£€æŸ¥å’Œå¼€å‘æ—¶ç¼–è¯‘
- ðŸŽ¯ **å‚æ•°éªŒè¯**ï¼šè‡ªåŠ¨æ£€æµ‹å¿…éœ€å‚æ•°å’Œå‚æ•°ç±»åž‹
- ðŸ“Š **æ‰§è¡Œæ—¥å¿—**ï¼šå¯è§†åŒ–æ‰§è¡ŒåŽ†å²å’Œç»“æžœæŸ¥çœ‹

## å®‰è£…å’Œè¿è¡Œ

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼ï¼ˆæŽ¨èï¼‰- ç›´æŽ¥è¿è¡Œ TypeScript
npm run dev

# å¼€å‘æ¨¡å¼ + æ–‡ä»¶ç›‘å¬ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev:watch

# ç”Ÿäº§æ¨¡å¼ - ç¼–è¯‘å¹¶è¿è¡Œ
npm start  # ä¼šè‡ªåŠ¨æ‰§è¡Œ build ç„¶åŽå¯åŠ¨

# æ‰‹åŠ¨ç¼–è¯‘ TypeScript
npm run build

# ç›‘å¬æ¨¡å¼ç¼–è¯‘
npm run build:watch

# æ¸…ç†ç¼–è¯‘æ–‡ä»¶
npm run clean
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬æ“ä½œ

1. å¯åŠ¨æœåŠ¡å™¨åŽè®¿é—® `http://localhost:8080`
2. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å‡½æ•°è°ƒç”¨ï¼Œæ ¼å¼ï¼š`æ¨¡å—å.å‡½æ•°å(å‚æ•°)`
3. ç‚¹å‡» "Execute" æŒ‰é’®æ‰§è¡Œå‡½æ•°
4. ç‚¹å‡» "ðŸ”„ Refresh" æŒ‰é’®åˆ·æ–°å¯ç”¨æ¨¡å—åˆ—è¡¨
5. ç‚¹å‡» "ðŸ“Š Logs" æŒ‰é’®æŸ¥çœ‹æ‰§è¡ŒåŽ†å²
6. ç‚¹å‡» "ðŸ—‘ï¸ Clear Logs" æ¸…ç©ºæ‰§è¡Œæ—¥å¿—

### é«˜çº§åŠŸèƒ½

- **è‡ªåŠ¨åˆ·æ–°**ï¼šå¯ç”¨åŽæ¯3ç§’è‡ªåŠ¨æ£€æµ‹æ¨¡å—å˜åŒ–
- **å‚æ•°éªŒè¯**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯å¿…éœ€å‚æ•°å’Œå‚æ•°ç±»åž‹
- **é”™è¯¯æç¤º**ï¼šæä¾›è¯¦ç»†çš„è¯­ä¹‰åŒ–é”™è¯¯ä¿¡æ¯
- **æ‰§è¡ŒåŽ†å²**ï¼šæ‰€æœ‰æ‰§è¡Œè®°å½•éƒ½ä¼šä¿å­˜åˆ°SQLiteæ•°æ®åº“

### ç¤ºä¾‹è°ƒç”¨

```javascript
// Bird æ¨¡å—
bird.fly('Eagle', 100)  // è®©é¸Ÿå„¿é£žè¡Œ

// Cat æ¨¡å—
cat.sayHi('Hello', 'Whiskers')     // çŒ«å’ªæ‰“æ‹›å‘¼
cat.purr('Fluffy', 8)              // çŒ«å’ªå‘¼å™œå£°
cat.sleep('Mittens', 'windowsill') // çŒ«å’ªç¡è§‰

// Dog æ¨¡å—
dog.fetch('Buddy', 'ball')  // ç‹—ç‹—æ¡çƒ
dog.bark('Rex', 3)          // ç‹—ç‹—å«å£°

// Duck æ¨¡å—
duck.sayHi('Hello', 'Donald')      // é¸­å­æ‰“æ‹›å‘¼
duck.walk('Donald')                // é¸­å­èµ°è·¯
duck.swim('Donald', 'pond')        // é¸­å­æ¸¸æ³³
duck.quack('Donald', 5)            // é¸­å­å«å£°

// Egg æ¨¡å—
egg.lay('Chicken')  // ä¸‹è›‹
```

### é”™è¯¯å¤„ç†ç¤ºä¾‹

```javascript
// å‚æ•°ä¸è¶³
dog.bark()  // é”™è¯¯ï¼šMissing required parameter 'name' (string)

// ä¸­æ–‡é€—å·é”™è¯¯
bird.fly("Eagle"ï¼Œ100)  // é”™è¯¯ï¼šInvalid comma character. Use English comma (,)

// å°¾éšé€—å·é”™è¯¯
cat.purr("Fluffy",)  // é”™è¯¯ï¼šTrailing comma in arguments

// æ— æ•ˆæ¨¡å—
unknown.test()  // é”™è¯¯ï¼šModule 'unknown' not found
```

## åŠ¨æ€æ¨¡å—åŠ è½½æµ‹è¯•

### æµ‹è¯•1ï¼šæ·»åŠ æ–°æ¨¡å—
1. åœ¨`scripts/`ç›®å½•ä¸‹åˆ›å»ºæ–°çš„`.ts`æ–‡ä»¶ï¼ˆå¦‚`robot.ts`ï¼‰
2. æ— éœ€é‡å¯æœåŠ¡å™¨ï¼Œç›´æŽ¥åœ¨Webç•Œé¢ç‚¹å‡»"Refresh Modules"
3. æ–°æ¨¡å—ä¼šç«‹å³å‡ºçŽ°åœ¨å¯ç”¨æ¨¡å—åˆ—è¡¨ä¸­

### æµ‹è¯•2ï¼šä¿®æ”¹çŽ°æœ‰æ¨¡å—
1. åœ¨çŽ°æœ‰æ¨¡å—æ–‡ä»¶ä¸­æ·»åŠ æ–°å‡½æ•°ï¼ˆå¦‚åœ¨`cat.ts`ä¸­æ·»åŠ `purr`å‡½æ•°ï¼‰
2. æ— éœ€é‡å¯æœåŠ¡å™¨ï¼Œæ–°å‡½æ•°ç«‹å³å¯ç”¨
3. åœ¨Webç•Œé¢ä¸­å¯ä»¥ç›´æŽ¥è°ƒç”¨æ–°æ·»åŠ çš„å‡½æ•°

## é¡¹ç›®ç»“æž„

```
â”œâ”€â”€ package.json         # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ tsconfig.json        # TypeScript é…ç½®
â”œâ”€â”€ nodemon.json         # Nodemon é…ç½®
â”œâ”€â”€ execution_log.db     # SQLiteæ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ src/                 # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.ts         # åº”ç”¨ç¨‹åºå…¥å£ç‚¹
â”‚   â”œâ”€â”€ client/         # å‰ç«¯ä»£ç 
â”‚   â”‚   â””â”€â”€ app.ts      # å®¢æˆ·ç«¯ TypeScript åº”ç”¨
â”‚   â”œâ”€â”€ server/         # æœåŠ¡å™¨ä»£ç 
â”‚   â”‚   â”œâ”€â”€ server.ts   # HTTP æœåŠ¡å™¨å®žçŽ°
â”‚   â”‚   â”œâ”€â”€ routes.ts   # è·¯ç”±å¤„ç†
â”‚   â”‚   â””â”€â”€ htmlTemplate.ts # HTML æ¨¡æ¿ç”Ÿæˆ
â”‚   â”œâ”€â”€ modules/        # æ¨¡å—ç®¡ç†
â”‚   â”‚   â””â”€â”€ moduleManager.ts # åŠ¨æ€æ¨¡å—åŠ è½½å™¨
â”‚   â”œâ”€â”€ database/       # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â””â”€â”€ sqlite.ts   # SQLite æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ auth.ts     # è®¤è¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ config.ts   # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ cors.ts     # CORS å¤„ç†
â”‚   â”‚   â”œâ”€â”€ logger.ts   # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ network.ts  # ç½‘ç»œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ rateLimiter.ts # é€ŸçŽ‡é™åˆ¶
â”‚   â”‚   â””â”€â”€ sanitizer.ts   # è¾“å…¥æ¸…ç†
â”‚   â””â”€â”€ types/          # TypeScript ç±»åž‹å®šä¹‰
â”‚       â””â”€â”€ index.ts    # é€šç”¨ç±»åž‹å®šä¹‰
â”œâ”€â”€ scripts/             # åŠ¨æ€æ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ bird.ts        # é¸Ÿæ¨¡å—
â”‚   â”œâ”€â”€ cat.ts         # çŒ«æ¨¡å—
â”‚   â”œâ”€â”€ duck.ts        # é¸­å­æ¨¡å—
â”‚   â””â”€â”€ egg.ts         # é¸¡è›‹æ¨¡å—
â””â”€â”€ dist/              # ç¼–è¯‘è¾“å‡ºç›®å½•ï¼ˆnpm run build åŽç”Ÿæˆï¼‰
```

## æŠ€æœ¯å®žçŽ°

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **TypeScript 5.8+**ï¼šå®Œæ•´çš„ç±»åž‹æ£€æŸ¥å’ŒçŽ°ä»£ ES ç‰¹æ€§æ”¯æŒ
- **Node.js 16+**ï¼šé«˜æ€§èƒ½ JavaScript è¿è¡Œæ—¶
- **SQLite3**ï¼šè½»é‡çº§åµŒå…¥å¼æ•°æ®åº“
- **ts-node**ï¼šç›´æŽ¥è¿è¡Œ TypeScriptï¼Œæ— éœ€é¢„ç¼–è¯‘

### æž¶æž„ç‰¹æ€§

- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¸…æ™°çš„åˆ†å±‚æž¶æž„ï¼Œæ˜“äºŽç»´æŠ¤å’Œæ‰©å±•
- **åŠ¨æ€æ¨¡å—åŠ è½½**ï¼šé€šè¿‡æ¸…é™¤ `require.cache` å®žçŽ°æ¨¡å—çƒ­é‡è½½
- **æ™ºèƒ½å‚æ•°è§£æž**ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å’Œ AST è§£æžï¼Œé¿å… `eval` å®‰å…¨é£Žé™©
- **è‡ªåŠ¨ç«¯å£æ£€æµ‹**ï¼šæ™ºèƒ½æ£€æµ‹å¯ç”¨ç«¯å£ï¼ˆ8080/8081ï¼‰
- **CORS æ”¯æŒ**ï¼šå®Œæ•´çš„è·¨åŸŸèµ„æºå…±äº«é…ç½®
- **é€ŸçŽ‡é™åˆ¶**ï¼šé˜²æ­¢ API æ»¥ç”¨çš„è¯·æ±‚é¢‘çŽ‡æŽ§åˆ¶
- **è¾“å…¥æ¸…ç†**ï¼šå…¨é¢çš„è¾“å…¥éªŒè¯å’Œæ¸…ç†æœºåˆ¶
- **é”™è¯¯å¤„ç†**ï¼šè¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯

### å®‰å…¨ç‰¹æ€§

- **å‚æ•°éªŒè¯**ï¼šä¸¥æ ¼çš„å‚æ•°ç±»åž‹å’Œå¿…éœ€æ€§æ£€æŸ¥
- **è¾“å…¥æ¸…ç†**ï¼šé˜²æ­¢ä»£ç æ³¨å…¥å’Œæ¶æ„è¾“å…¥
- **API è®¤è¯**ï¼šåŸºäºŽå¯†é’¥çš„ API è®¿é—®æŽ§åˆ¶
- **è¯·æ±‚é™åˆ¶**ï¼šé˜²æ­¢ DoS æ”»å‡»çš„é€ŸçŽ‡é™åˆ¶

## æ•°æ®åº“ç»“æž„

```sql
CREATE TABLE execution_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    call_string TEXT NOT NULL,      -- å‡½æ•°è°ƒç”¨å­—ç¬¦ä¸²
    result TEXT NOT NULL,           -- æ‰§è¡Œç»“æžœ
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## API ç«¯ç‚¹

### ä¸»è¦ç«¯ç‚¹

- `GET /` - ä¸»é¡µé¢ï¼ˆWeb ç•Œé¢ï¼‰
- `GET /client.js` - å®¢æˆ·ç«¯ JavaScript æ–‡ä»¶
- `GET /api/modules` - èŽ·å–å¯ç”¨æ¨¡å—åˆ—è¡¨
- `POST /api/execute` - æ‰§è¡Œå‡½æ•°è°ƒç”¨
- `GET /api/logs` - èŽ·å–æ‰§è¡Œæ—¥å¿—
- `DELETE /api/logs` - æ¸…ç©ºæ‰§è¡Œæ—¥å¿—

### API è¯¦ç»†è¯´æ˜Ž

#### èŽ·å–æ¨¡å—åˆ—è¡¨
```http
GET /api/modules?forceRefresh=true
```

#### æ‰§è¡Œå‡½æ•°
```http
POST /api/execute
Content-Type: application/json

{
  "callString": "dog.bark('Buddy', 3)"
}
```

#### å“åº”æ ¼å¼
```json
// æˆåŠŸå“åº”
{
  "result": "Dog Buddy barked 3 times! Woof woof!"
}

// é”™è¯¯å“åº”
{
  "error": "Missing required parameter 'name' (string)"
}
```

## çŽ¯å¢ƒè¦æ±‚

- **Node.js**: >= 16.0.0
- **npm**: >= 7.0.0
- **æ“ä½œç³»ç»Ÿ**: macOS, Linux, Windows

## çŽ¯å¢ƒå˜é‡é…ç½®

é¡¹ç›®æ”¯æŒé€šè¿‡çŽ¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ã€‚è¯·å¤åˆ¶ `.env.example` æ–‡ä»¶ä¸º `.env` å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®ï¼š

```bash
cp .env.example .env
```

### ä¸»è¦çŽ¯å¢ƒå˜é‡

- `API_KEY`: API è®¤è¯å¯†é’¥ï¼ˆç”Ÿäº§çŽ¯å¢ƒå¿…éœ€ï¼‰
- `NODE_ENV`: è¿è¡ŒçŽ¯å¢ƒï¼ˆdevelopment/productionï¼‰
- `PORT`: è‡ªå®šä¹‰ç«¯å£ï¼ˆå¯é€‰ï¼Œé»˜è®¤è‡ªåŠ¨æ£€æµ‹ï¼‰
- `DEBUG`: å¯ç”¨è°ƒè¯•æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

## å¼€å‘æŒ‡å—

### å¿«é€Ÿå¼€å§‹

1. **çŽ¯å¢ƒé…ç½®**ï¼šå¤åˆ¶å¹¶é…ç½®çŽ¯å¢ƒå˜é‡
   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½® API_KEY ç­‰é…ç½®
   ```

2. **å®‰è£…ä¾èµ–**ï¼š
   ```bash
   npm install
   ```

3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**ï¼š
   ```bash
   npm run dev
   ```

### æ·»åŠ æ–°æ¨¡å—

1. åœ¨ `scripts/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ `.ts` æ–‡ä»¶
2. å¯¼å‡ºå‡½æ•°å¹¶æ·»åŠ  JSDoc æ³¨é‡Š
3. æ— éœ€é‡å¯æœåŠ¡å™¨ï¼Œç‚¹å‡»åˆ·æ–°å³å¯åŠ è½½

### æ¨¡å—ç¤ºä¾‹

```typescript
/**
 * Make a robot move
 * @param name - Robot name
 * @param direction - Movement direction
 * @returns Movement message
 */
export const move = (name: string, direction: string): string => {
  return `Robot ${name} is moving ${direction}!`;
};
```